
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using LASSO-CACTI Data, Part 2: Animation of a Cross Section &#8212; ARM Open Science Summer School 2024</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/lasso/lasso-cacti_part2';</script>
    <link rel="icon" href="../../_static/arm_logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Introduction to xwrf" href="../xarray/xwrf-xarray-intro.html" />
    <link rel="prev" title="Overview of LASSO-CACTI Data and Ways to Work with it" href="lasso-cacti.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="21 May 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/arm_logo.png" class="logo__image only-light" alt="ARM Open Science Summer School 2024 - Home"/>
    <script>document.write(`<img src="../../_static/arm_logo.png" class="logo__image only-dark" alt="ARM Open Science Summer School 2024 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ARM-Development/arm-summer-school-2024" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/@armuserfacility9698" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    ARM Summer School 2024
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Logistics + Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recommendations.html">Recommendations and Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instructors.html">Instructors and Mentors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Preparation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../preliminary/checklist_index.html">Checklist</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../preliminary/checklist/github.html">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preliminary/checklist/jupyterhub.html">JupyterHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preliminary/checklist/git.html">Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preliminary/checklist/armdata.html">ARM Account Login</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../preliminary/skills_refresher_index.html">Skills Refresher</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../preliminary/skills-refresher/swc.html">Software Carpentry Training</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../projects/projects.html">Summer School Projects</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pyart/pyart-basics.html">Py-ART Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pyart/pyart-gridding.html">Py-ART Gridding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../act/act_tutorial_comble.html">ACT Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xarray/xarray-intro.html">Introduction to Xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="lasso-shcu.html">Overview of LASSO-ShCu Data for Southern Great Plains</a></li>
<li class="toctree-l2"><a class="reference internal" href="lasso-shcu_part2.html">Part 2 of LASSO-ShCu Tutorial: Quick-look 3-D Isosurface Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="lasso-cacti.html">Overview of LASSO-CACTI Data and Ways to Work with it</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Using LASSO-CACTI Data, Part 2: Animation of a Cross Section</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xarray/xwrf-xarray-intro.html">Introduction to xwrf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../comble/comble-mip-tutorial.html">COMBLE-MIP Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emc2/InstrumentSimulatorsForModelEvaluation.html">Harnessing instrument simulators for model evaluation</a></li>






<li class="toctree-l2"><a class="reference internal" href="../microhh/analyze_microhh.html">Analyze microhh LES data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../machine_learning/ARM_DQO_Spike_Detection.html">ARM Data Quality Office ML Spike Detection</a></li>







<li class="toctree-l2"><a class="reference internal" href="../pyart/sail_qpe_grid.html">Snowfall Retrievals from SAIL X-Band Radar</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyterhub.arm.gov/hub/user-redirect/git-pull?repo=https%3A//github.com/ARM-Development/arm-summer-school-2024&urlpath=lab/tree/arm-summer-school-2024/tutorials/lasso/lasso-cacti_part2.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ARM-Development/arm-summer-school-2024" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ARM-Development/arm-summer-school-2024/edit/main/tutorials/lasso/lasso-cacti_part2.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ARM-Development/arm-summer-school-2024/issues/new?title=Issue%20on%20page%20%2Ftutorials/lasso/lasso-cacti_part2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/tutorials/lasso/lasso-cacti_part2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using LASSO-CACTI Data, Part 2: Animation of a Cross Section</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-data-for-plotting-a-single-time">Read the data for plotting a single time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrf-model-levels">WRF Model Levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-up-the-cross-section-plot">Building up the cross-section plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-an-animation-of-the-cross-section">Make an animation of the cross section</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-video-output">Example video output</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qcloud-qice-for-domain-2-29-jan-2019-eda09-forcing"><strong>QCloud + QIce for Domain 2, 29-Jan-2019, EDA09 Forcing:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qcloud-qice-for-domain-4-29-jan-2019-eda09-forcing"><strong>QCloud + QIce for Domain 4, 29-Jan-2019, EDA09 Forcing:</strong></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-lasso-cacti-data-part-2-animation-of-a-cross-section">
<h1>Using LASSO-CACTI Data, Part 2: Animation of a Cross Section<a class="headerlink" href="#using-lasso-cacti-data-part-2-animation-of-a-cross-section" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<p><strong>Author:</strong> William.Gustafson&#64;pnnl.gov<br />
<strong>Date:</strong> 13-May-2024</p>
<p>Plotting vertical cross sections involves dealing with vertical coordinate systems, which can vary beteween models and post-processed datasets. For example, LASSO-CACTI includes terrain-following data on raw model levles plus ineterpolated data on pressure and height levels.</p>
<p><strong>Objectives of this notebook:</strong></p>
<ol class="arabic simple">
<li><p>Learn about how to work with the vertical coordinates by plotting a cross section</p></li>
<li><p>Learn about efficient animation creation within matplotlib</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Libraries required for this tutorial...</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
</pre></div>
</div>
</div>
</div>
<p>First, we need to make a few choices regarding what to plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># User settings...</span>

<span class="c1"># Case date and times to plot:</span>
<span class="n">case_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span>
<span class="n">single_time</span> <span class="o">=</span> <span class="n">case_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># time for single-time plots</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="n">case_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># start and end times for animation</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="n">case_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>

<span class="c1"># Simulation selection within the case date:</span>
<span class="n">ens_name</span> <span class="o">=</span> <span class="s2">&quot;eda09&quot;</span>
<span class="n">config_label</span> <span class="o">=</span> <span class="s2">&quot;base&quot;</span>
<span class="n">domain</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Cross section details:</span>
<span class="n">plot_lat</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">32.</span><span class="o">+</span><span class="p">(</span><span class="mf">7.</span><span class="o">/</span><span class="mf">60.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">35.076</span><span class="o">/</span><span class="mf">3600.</span><span class="p">))</span>  <span class="c1"># latitude to sample</span>
<span class="n">max_hamsl</span> <span class="o">=</span> <span class="mi">11000</span>  <span class="c1"># maximum height to plot</span>

<span class="c1"># Other details:</span>
<span class="c1"># rootpath_wrf = &quot;/gpfs/wolf2/arm/cli120/world-shared/d3m088/cacti/staged_runs&quot;  # on cumulus</span>
<span class="n">rootpath_wrf</span> <span class="o">=</span> <span class="s2">&quot;/data/project/ARM_Summer_School_2024_Data/lasso_tutorial/cacti/lasso-cacti&quot;</span>  <span class="c1"># on Jupyter</span>

<span class="n">path_out</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>  <span class="c1"># path to save animation file</span>
</pre></div>
</div>
</div>
</div>
<section id="read-the-data-for-plotting-a-single-time">
<h2>Read the data for plotting a single time<a class="headerlink" href="#read-the-data-for-plotting-a-single-time" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>First, we will do the quick-and-dirty approach that is good for quick looks. For kicks, let’s compare how this comes out for data on the raw model levels versus interpolate height levels.
We will first just look at a single time to get an idea of how the cross section plots work for different level types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grab data for a single time to play with examples at this point...</span>

<span class="c1"># We will pull data for the terrain height from the static file a single time since it is constant.</span>
<span class="c1"># We will use the appropriate subset file for the desired plotting variable.</span>


<span class="c1"># Get the WRF path and open the file...</span>
<span class="c1"># This assumes the file folder structure used on ARM&#39;s cumulus cluster with data organized in a tree structure by  </span>
<span class="c1"># date / ensemble member / configuration label / scale (meso or LES) / and file type.</span>
<span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;meso&quot;</span> <span class="k">if</span> <span class="n">domain</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;les&quot;</span>
<span class="n">path_wrf_subset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rootpath_wrf</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">/subset_d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># ...a static file for the constant information like terrain height</span>
<span class="n">filename_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_stat_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y%m%d.%H%M</span><span class="si">}</span><span class="s2">00.nc&quot;</span>
<span class="n">ds_stat</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename_wrf</span><span class="p">)</span>

<span class="c1"># ...a meteorology state file, which we need for the height of each grid cell on raw model levels</span>
<span class="n">filename_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_met_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y%m%d.%H%M</span><span class="si">}</span><span class="s2">00.nc&quot;</span>
<span class="n">ds_met</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename_wrf</span><span class="p">)</span>

<span class="c1"># ...a cloud subset on raw model levels</span>
<span class="n">filename_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_cld_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y%m%d.%H%M</span><span class="si">}</span><span class="s2">00.nc&quot;</span>
<span class="n">ds_cld</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename_wrf</span><span class="p">)</span>

<span class="c1"># ...a cloud subset height-above-mean-sea-level levels</span>
<span class="n">filename_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_cldhamsl_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y%m%d.%H%M</span><span class="si">}</span><span class="s2">00.nc&quot;</span>
<span class="n">ds_cldhamsl</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename_wrf</span><span class="p">)</span>

<span class="c1"># Next, we have to figure out which j-index to sample for the desired latitude. WRF&#39;s coordinate name for this dimension is south_north.</span>
<span class="c1"># We will ignore the map projection and pull along a single j index, which we will determine from the middle of the grid.</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">ds_stat</span><span class="p">[</span><span class="s2">&quot;XLAT&quot;</span><span class="p">]</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">ds_stat</span><span class="p">[</span><span class="s2">&quot;XLONG&quot;</span><span class="p">]</span>
<span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">shape</span>
<span class="n">abslat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">west_east</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nlon</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">plot_lat</span><span class="p">)</span>
<span class="n">jloc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">abslat</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">lonslice</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>

<span class="c1"># Select the specific variables used for plotting...</span>

<span class="c1"># Note that we do not worry about parsing the time for the terrain height</span>
<span class="c1"># since it is constant in time (in a static file). In theory, we could also</span>
<span class="c1"># do this for var_name, but if we ever combine times into one file, it could</span>
<span class="c1"># cause trouble, so we do a specific time selection for var_name.</span>

<span class="c1"># ...get the coordinate information first, which we will subset for the the cross-section swath</span>
<span class="n">hgt</span> <span class="o">=</span> <span class="n">ds_stat</span><span class="p">[</span><span class="s2">&quot;HGT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>  <span class="c1"># terrain height along the cross section&#39;s swath</span>
<span class="n">hamsl_raw</span> <span class="o">=</span> <span class="n">ds_met</span><span class="p">[</span><span class="s1">&#39;HAMSL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>  <span class="c1"># height of each grid cell on the raw model levels</span>
<span class="n">hamsl_hamsl</span> <span class="o">=</span> <span class="n">ds_cldhamsl</span><span class="p">[</span><span class="s2">&quot;HAMSL&quot;</span><span class="p">]</span>  <span class="c1"># height of each grid cell in the HAMSL file (constant in space, so no need to subset j index)</span>

<span class="c1"># ...and now the data we actually want to plot, which is clouds</span>
<span class="c1"># We&#39;ll pull both on raw model levels and on the interpolated HAMSL, so we have everything we need for our examples.</span>
<span class="n">plotdata_raw</span> <span class="o">=</span> <span class="mf">1000.</span><span class="o">*</span><span class="p">(</span>
    <span class="n">ds_cld</span><span class="p">[</span><span class="s1">&#39;QCLOUD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">ds_cld</span><span class="p">[</span><span class="s1">&#39;QICE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>  
    <span class="p">)</span>  <span class="c1"># cloud water+ice mixing ratio converted go g/kg</span>
<span class="n">plotdata_hamsl</span> <span class="o">=</span> <span class="mf">1000.</span><span class="o">*</span><span class="p">(</span>
    <span class="n">ds_cldhamsl</span><span class="p">[</span><span class="s1">&#39;QCLOUD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">ds_cldhamsl</span><span class="p">[</span><span class="s1">&#39;QICE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>  
    <span class="p">)</span>  <span class="c1"># cloud water+ice mixing ratio converted go g/kg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR 1: PROJ: proj_create_from_database: Open of /opt/conda/share/proj failed
</pre></div>
</div>
</div>
</div>
</section>
<section id="wrf-model-levels">
<h2>WRF Model Levels<a class="headerlink" href="#wrf-model-levels" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Before embarking on plotting the model output, we need to understand the WRF model’s vertical coordinate. Full details are at https://www2.mmm.ucar.edu/wrf/users/wrf_users_guide/build/html/dynamics.html. For our purposes here, the important thing to know is that the WRF configuration for LASSO-CACTI (and most modern WRF runs) uses a hybrid coordinate system that is 1) terrain following, and 2) hybrid in that it combines pressure-level and terrain-following levels, with stronger terrain-following weigting in the lower atmosphere.</p>
<p>What does this look like? Here is a plot showing the level surfaces every 10 levels from LASSO-CACTI model output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the raw model levels...</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">hamsl_xz</span> <span class="o">=</span> <span class="n">hamsl_raw</span>
<span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lonslice</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">hamsl_xz</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">hamsl_xz</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                    <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">nk</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">hamsl_xz</span><span class="o">.</span><span class="n">shape</span>
<span class="n">dk</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">dk</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lonslice</span><span class="p">,</span> <span class="n">hamsl_xz</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">bottom_top</span><span class="o">=</span><span class="n">k</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LASSO-CACTI Vertical Grid, Every </span><span class="si">{</span><span class="n">dk</span><span class="si">}</span><span class="s2"> Levels&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degE)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;HAMLS (m)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1128/2453751272.py:6: UserWarning: The input coordinates to pcolormesh are interpreted as cell centers, but are not monotonically increasing or decreasing. This may lead to incorrectly calculated cell edges, in which case, please supply explicit cell edges to pcolormesh.
  pcm = ax.pcolormesh(lonslice.values, hamsl_xz.values, hamsl_xz.values,
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;HAMLS (m)&#39;)
</pre></div>
</div>
<img alt="../../_images/6ddfac603c93ed8ba0cd03f17f2f111ccd1e3a842930463a3e86546f031a3901.png" src="../../_images/6ddfac603c93ed8ba0cd03f17f2f111ccd1e3a842930463a3e86546f031a3901.png" />
</div>
</div>
<p>One must make choices for how to deal with the warping of level surfaces. Depending on one’s needs, you have several options for how to work with the model data:</p>
<ol class="arabic simple">
<li><p>Ignore the warping, essentially pretending it does not exist</p></li>
<li><p>Interpolate the data to new levels based on an alternate surface; examples inlude height or pressure levels, and then plot on the new surface type</p></li>
<li><p>Keep the data in a warped space and tell the plotting software the shape of the levels</p></li>
</ol>
<p>Option 1 is the quickest and easiest approach. Option 2 can be useful for reducing data if one does not need all the raw level information. Option 3 is the brute force approach, but is often the best if one has data to define the level information.</p>
</section>
<section id="building-up-the-cross-section-plot">
<h2>Building up the cross-section plot<a class="headerlink" href="#building-up-the-cross-section-plot" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Let’s build up the plot to see how data and/or plotting complexity impacts our results.</p>
<p>For the first plot, we will do a quick-and-dirty plot that can be useful for quick looks (Option 1 from above). Xarray has built-in plotting capabilties that can use the coordinates and attributes associated with each variable. Since xarray cannot decipher the warped WRF grid, it treats all the levels as flat by default.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting version 1: A quick-look plot using xarray&#39;s defaults when reading the subset files</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plotdata_raw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># left panel is on raw model levels -- this is Option 1 from above</span>
<span class="n">plotdata_hamsl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># right panel is on HAMSL as interpolated in subset file -- this is Option 2 from above</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a3eff385d2db58fcc01ecfc819b0631ba9a528c05c372f5148503d7dc2e55c48.png" src="../../_images/a3eff385d2db58fcc01ecfc819b0631ba9a528c05c372f5148503d7dc2e55c48.png" />
</div>
</div>
<p>The above plots are useful, but they have some limitations. For example, treating the raw model levels as flat surfaces hides the mountain. And, labeling levels by index makes it hard to really know how tall the cloud is.
The plot on the right solves these two issues, but the limited number of levels results in a blocky mountain. There was also a fair bit of effort under the hood to interpolate to HAMSL. If you were to work from raw model output, you would need to code up the interpolation in addition to the plotting. This can be a bit much for quick looks. The other limitation is that the x-axis is still in units of index, which we would prefer to be labelled as longitude.</p>
<p>How can we plot the raw model level information as realistic, non-flat surfaces? This is Option 3 from above. Let’s do that next. We have to move beyond xarray’s tools and code this using individual matplotlib routines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting version 2: Code it up yourself with bells and whistles to get full level of detail</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>

<span class="c1"># NOTE: remember we typically have to extract the values from the xarray DataArrays when passing info to matplotlib</span>
<span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lonslice</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">hamsl_raw</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">plotdata_raw</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                    <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Add the colorbar...</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">.75</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QCLOUD+QICE (g/kg)&quot;</span><span class="p">)</span>

<span class="c1"># Add our labels...</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degE)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Height AMSL (m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_hamsl</span><span class="p">)</span>  <span class="c1"># hide the model top</span>

<span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M</span><span class="si">}</span><span class="s2"> UTC&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cloud Condensate; Latitude=</span><span class="si">{</span><span class="n">plot_lat</span><span class="si">}</span><span class="s2"> degN</span><span class="se">\n</span><span class="si">{</span><span class="n">time_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">run_info_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Case=</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y-%m-%d</span><span class="si">}</span><span class="s2">; Ensemble=</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">; Config=</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">; Dom=</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">run_info_label</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;figure fraction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1128/1363436238.py:6: UserWarning: The input coordinates to pcolormesh are interpreted as cell centers, but are not monotonically increasing or decreasing. This may lead to incorrectly calculated cell edges, in which case, please supply explicit cell edges to pcolormesh.
  pcm = ax.pcolormesh(lonslice.values, hamsl_raw.values, plotdata_raw.values,
</pre></div>
</div>
<img alt="../../_images/04f169a76ba2ec01e51f2bb329a4c3de8173665923af0b01c5726626ad977d7f.png" src="../../_images/04f169a76ba2ec01e51f2bb329a4c3de8173665923af0b01c5726626ad977d7f.png" />
</div>
</div>
</section>
<section id="make-an-animation-of-the-cross-section">
<h2>Make an animation of the cross section<a class="headerlink" href="#make-an-animation-of-the-cross-section" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The above plot is pretty good. How about animating it across time? There are two common approaches to making an animation with matplotlib. One is to plot each frame, save it as a file, and then connect the frames together into an animation using a tool like ffmpeg. This is good when you want access to single frames for later use, such as putting them in a paper or presentation. This is also embarassingly parallel, so one can use parallelization tools to speed up the plotting by spreading across cores and/or nodes.</p>
<p>The second approach is to use the animation capabilities embedded within matplotlib. This is often much faster than plotting every frame inependently, as is done in the first approach. Setting up a matplotlib image has a fair amount of overhead, e.g., to determine the colors, axis limits, map projection, color bar, etc. Approach #1 has to do all this work for every frame. Approach #2 only has to do the overhead once, and then subsequent frames only need to have the new data dropped into the memory location that holds the plot details. This simple memory copy is so fast that it can often be faster to do the animation this way than in parallel. Note that the one downside of approach #2 is that it is serial since we have to work with the one spot in memory and build up the animation as we go.</p>
<p>Here is an example code to build an animation using approach #2.</p>
<p>Since we have to now read a time series of data instead of a single time, we will re-read all our data, essentially from scratch. The basic approach is the same though other than we now need to open a multi-file dataset and work with multiple times in our plotting code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grab data for multiple times to make an animation...</span>

<span class="c1"># We will pull data for the terrain height from the static file a single time since it is constant.</span>
<span class="c1"># We will use globs to grab all the filenames of a given file type for the selected run, and then </span>
<span class="c1"># we can use xarray to select the specific times and throw out the unneeded time. Alternatively, we</span>
<span class="c1"># could build a list of files for just the times we want, but that takes a lot more code.</span>

<span class="c1"># Get the WRF path and open the file...</span>
<span class="c1"># This assumes the file folder structure used on ARM&#39;s cumulus cluster with data organized in a tree structure by  </span>
<span class="c1"># date / ensemble member / configuration label / scale (meso or LES) / and file type.</span>
<span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;meso&quot;</span> <span class="k">if</span> <span class="n">domain</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;les&quot;</span>
<span class="n">path_wrf_subset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rootpath_wrf</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">/subset_d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># ...a static file for the constant information like terrain height</span>
<span class="n">filename_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_stat_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y%m%d.%H%M</span><span class="si">}</span><span class="s2">00.nc&quot;</span>
<span class="n">ds_stat</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename_wrf</span><span class="p">)</span>

<span class="c1"># ...a meteorology state file, which we need for the height of each grid cell on raw model levels</span>
<span class="n">glob_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_met_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.*.nc&quot;</span>
<span class="n">ds_met</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">glob_wrf</span><span class="p">)</span>
<span class="n">ds_met</span> <span class="o">=</span> <span class="n">ds_met</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_start</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_end</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)))</span>

<span class="c1"># ...a cloud subset on raw model levels</span>
<span class="n">glob_wrf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_wrf_subset</span><span class="si">}</span><span class="s2">/corlasso_cld_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">_M1.m1.*.nc&quot;</span>
<span class="n">ds_cld</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">glob_wrf</span><span class="p">)</span>
<span class="n">ds_cld</span> <span class="o">=</span> <span class="n">ds_cld</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_start</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_end</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M:%S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)))</span>

<span class="c1"># Next, we have to figure out which j-index to sample for the desired latitude. WRF&#39;s coordinate name for this dimension is south_north.</span>
<span class="c1"># We will ignore the map projection and pull along a single j index, which we will determine from the middle of the grid.</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">ds_stat</span><span class="p">[</span><span class="s2">&quot;XLAT&quot;</span><span class="p">]</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">ds_stat</span><span class="p">[</span><span class="s2">&quot;XLONG&quot;</span><span class="p">]</span>
<span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">shape</span>
<span class="n">abslat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">west_east</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nlon</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">plot_lat</span><span class="p">)</span>
<span class="n">jloc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">abslat</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">lonslice</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>

<span class="c1"># Select the specific variables used for plotting...</span>

<span class="c1"># ...get the coordinate information first, which we will subset for the the cross-section swath</span>
<span class="n">hgt</span> <span class="o">=</span> <span class="n">ds_stat</span><span class="p">[</span><span class="s2">&quot;HGT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>  <span class="c1"># terrain height along the cross section&#39;s swath</span>
<span class="n">hamsl_raw</span> <span class="o">=</span> <span class="n">ds_met</span><span class="p">[</span><span class="s1">&#39;HAMSL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>  <span class="c1"># height of each grid cell on the raw model levels</span>

<span class="c1"># ...and now the data we actually want to plot, which is clouds</span>
<span class="n">plotdata_raw</span> <span class="o">=</span> <span class="mf">1000.</span><span class="o">*</span><span class="p">(</span>
    <span class="n">ds_cld</span><span class="p">[</span><span class="s1">&#39;QCLOUD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">ds_cld</span><span class="p">[</span><span class="s1">&#39;QICE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="n">jloc</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># cloud water+ice mixing ratio converted go g/kg</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have all the data available to us (either in memory or via xarray chunks), we can move on to making the animation.</p>
<p>The way matplotlib’s animation routine works is to use a pre-defined subroutine that contains the instructions for what data gets overlaid when making a new frame. So, we will first define this routine, followed by the code to make the first frame, and a loop to call the subroutine for subsequent frames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">plot_subsequent_frame</span><span class="p">(</span><span class="n">itime</span><span class="p">,</span> <span class="n">plot_lat</span><span class="p">,</span> <span class="n">plotdata_raw</span><span class="p">,</span> <span class="n">pcm</span><span class="p">,</span> <span class="n">tx_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subroutine to plot the next frame of an animation after the first frame is already defined. </span>
<span class="sd">    This is to be called by animation.FuncAnimation. </span>
<span class="sd">    </span>
<span class="sd">    Note that some data is pulled from global scope. Variables accessed from outside the subroutine:</span>
<span class="sd">        pcm = pcolormesh object from the initial frame</span>
<span class="sd">        tx_time = text annotation object for the time label from the initial frame</span>

<span class="sd">        plotdata_raw = variable holding the time series of data to plot</span>
<span class="sd">        plot_lat = latitude being plotted (needed to reconstruct the title text)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plotting frame &quot;</span><span class="p">,</span> <span class="n">itime</span><span class="p">)</span>

    <span class="c1"># Overwrite the data in memory for the values displayed in the plot...</span>
    <span class="c1"># NOTE: This is technically a faux paux for WRF since the model levels are not constant in time. BE CAREFUL!</span>
    <span class="c1">#       However, in this situation the levels are not going to change so much as to make the plot visibly change much.</span>
    <span class="n">pcm</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">plotdata_raw</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="n">itime</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="c1"># Update the time label...</span>
    <span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">plotdata_raw</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])[</span><span class="n">itime</span><span class="p">]</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M</span><span class="si">}</span><span class="s2"> UTC&quot;</span>
    <span class="n">tx_time</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cloud Condensate; Latitude=</span><span class="si">{</span><span class="n">plot_lat</span><span class="si">}</span><span class="s2"> degN</span><span class="se">\n</span><span class="si">{</span><span class="n">time_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># end plot_subsequent_frame()</span>


<span class="c1">#-----------------------------------------------------------------------</span>
<span class="c1"># Plot the first frame of the animation...</span>

<span class="n">ntimes</span> <span class="o">=</span> <span class="n">plotdata_raw</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>

<span class="c1"># NOTE: Select the first time when accessing the time series variables.</span>
<span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lonslice</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">hamsl_raw</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">plotdata_raw</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.25</span><span class="p">))</span>

<span class="c1"># Add the colorbar...</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">.75</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QCLOUD+QICE (g/kg)&quot;</span><span class="p">)</span>

<span class="c1"># Add our labels...</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degE)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Height AMSL (m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_hamsl</span><span class="p">)</span>  <span class="c1"># hide the model top</span>

<span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">single_time</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M</span><span class="si">}</span><span class="s2"> UTC&quot;</span>
<span class="n">tx_time</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cloud Condensate; Latitude=</span><span class="si">{</span><span class="n">plot_lat</span><span class="si">}</span><span class="s2"> degN</span><span class="se">\n</span><span class="si">{</span><span class="n">time_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">run_info_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Case=</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y-%m-%d</span><span class="si">}</span><span class="s2">; Ensemble=</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">; Config=</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">; Dom=</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">run_info_label</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;figure fraction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>


<span class="c1">#-----------------------------------------------------------------------</span>
<span class="c1"># Now, update the underlying data in the plot for each subsequent frame...</span>

<span class="c1"># NOTE: See https://matplotlib.org/stable/api/_as_gen/matplotlib.animation.FuncAnimation.html for</span>
<span class="c1">#       explaination of how to use functools.partial for passing arguments to the redraw subroutine.</span>
<span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> 
                              <span class="n">partial</span><span class="p">(</span><span class="n">plot_subsequent_frame</span><span class="p">,</span> <span class="n">plot_lat</span><span class="o">=</span><span class="n">plot_lat</span><span class="p">,</span> <span class="n">plotdata_raw</span><span class="o">=</span><span class="n">plotdata_raw</span><span class="p">,</span> <span class="n">pcm</span><span class="o">=</span><span class="n">pcm</span><span class="p">,</span> <span class="n">tx_time</span><span class="o">=</span><span class="n">tx_time</span><span class="p">),</span>
                              <span class="n">frames</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">ntimes</span><span class="p">))</span>

<span class="c1"># And save the results...</span>
<span class="n">filename_mp4</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_out</span><span class="si">}</span><span class="s2">/corlasso_anim_qci_</span><span class="si">{</span><span class="n">case_date</span><span class="si">:</span><span class="s2">%Y%m%d</span><span class="si">}</span><span class="s2">00</span><span class="si">{</span><span class="n">ens_name</span><span class="si">}</span><span class="s2">d</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_label</span><span class="si">}</span><span class="s2">.mp4&quot;</span>
<span class="n">fps</span> <span class="o">=</span> <span class="mi">6</span> <span class="k">if</span> <span class="n">domain</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">8</span>  <span class="c1"># set frame rate for dt=15 vs. 5 minutes</span>
<span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename_mp4</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">animation</span><span class="o">.</span><span class="n">FFMpegWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s2">&quot;h264&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1128/2070819929.py:35: UserWarning: The input coordinates to pcolormesh are interpreted as cell centers, but are not monotonically increasing or decreasing. This may lead to incorrectly calculated cell edges, in which case, please supply explicit cell edges to pcolormesh.
  pcm = ax.pcolormesh(lonslice.values, hamsl_raw.isel(Time=0).values, plotdata_raw.isel(Time=0).values,
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>plotting frame  0
plotting frame  0
plotting frame  1
plotting frame  2
plotting frame  3
plotting frame  4
plotting frame  5
plotting frame  6
plotting frame  7
plotting frame  8
plotting frame  9
plotting frame  10
plotting frame  11
plotting frame  12
plotting frame  13
plotting frame  14
plotting frame  15
plotting frame  16
plotting frame  17
plotting frame  18
plotting frame  19
plotting frame  20
plotting frame  21
plotting frame  22
plotting frame  23
plotting frame  24
plotting frame  25
plotting frame  26
plotting frame  27
plotting frame  28
plotting frame  29
plotting frame  30
plotting frame  31
plotting frame  32
plotting frame  33
plotting frame  34
plotting frame  35
plotting frame  36
plotting frame  37
plotting frame  38
plotting frame  39
plotting frame  40
plotting frame  41
plotting frame  42
plotting frame  43
plotting frame  44
plotting frame  45
plotting frame  46
plotting frame  47
plotting frame  48
plotting frame  0
</pre></div>
</div>
<img alt="../../_images/bf78205318fff7616f8682fef84beea23801d1c84d5ddbc06c70029ec6e18410.png" src="../../_images/bf78205318fff7616f8682fef84beea23801d1c84d5ddbc06c70029ec6e18410.png" />
</div>
</div>
</section>
<section id="example-video-output">
<h2>Example video output<a class="headerlink" href="#example-video-output" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Here are two example renderings of the above animation, one for domain 2 and the other for domain 4.</p>
<section id="qcloud-qice-for-domain-2-29-jan-2019-eda09-forcing">
<h3><strong>QCloud + QIce for Domain 2, 29-Jan-2019, EDA09 Forcing:</strong><a class="headerlink" href="#qcloud-qice-for-domain-2-29-jan-2019-eda09-forcing" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/dd1c01788b552c27392dcbf9f19b6eb0/corlasso_anim_qci_2019012900eda09d2_base.mp4"><span class="xref download myst">corlasso_anim_qci_2019012900eda09d2_base.mp4</span></a><br />
<video src="../images/tutorial_lasso/corlasso_anim_qci_2019012900eda09d2_base.mp4" controls></video></p>
</section>
<section id="qcloud-qice-for-domain-4-29-jan-2019-eda09-forcing">
<h3><strong>QCloud + QIce for Domain 4, 29-Jan-2019, EDA09 Forcing:</strong><a class="headerlink" href="#qcloud-qice-for-domain-4-29-jan-2019-eda09-forcing" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/a5be32b86b4b5ec8a6ee22c3ed9d831b/corlasso_anim_qci_2019012900eda09d4_base.mp4"><span class="xref download myst">corlasso_anim_qci_2019012900eda09d4_base.mp4</span></a><br />
<video src="../images/tutorial_lasso/corlasso_anim_qci_2019012900eda09d4_base.mp4" controls></video></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-base-py"
        },
        kernelOptions: {
            name: "conda-base-py",
            path: "./tutorials/lasso"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-base-py'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lasso-cacti.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Overview of LASSO-CACTI Data and Ways to Work with it</p>
      </div>
    </a>
    <a class="right-next"
       href="../xarray/xwrf-xarray-intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to xwrf</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-data-for-plotting-a-single-time">Read the data for plotting a single time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrf-model-levels">WRF Model Levels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-up-the-cross-section-plot">Building up the cross-section plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-an-animation-of-the-cross-section">Make an animation of the cross section</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-video-output">Example video output</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qcloud-qice-for-domain-2-29-jan-2019-eda09-forcing"><strong>QCloud + QIce for Domain 2, 29-Jan-2019, EDA09 Forcing:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qcloud-qice-for-domain-4-29-jan-2019-eda09-forcing"><strong>QCloud + QIce for Domain 4, 29-Jan-2019, EDA09 Forcing:</strong></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the <a href="https://www.arm.gov/">ARM Open Science</a> Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on 21 May 2024.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>